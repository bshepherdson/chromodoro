<div class="page-header">
  <div class="row-fluid">
    <div class="span4">
      <h1>{{ task.name || "Loading" }}</h1>
    </div>
    <div class="offset4 span2" data-ng-show="pomodoro">
      <div class="row-fluid">
        <p data-ng-show="pomodoro.task && (pomodoro.type == 'task' || !pomodoro.active)" class="text-error">{{ pomodoro.task.name }}: {{ showMine(pomodoro.task) }}</p>
        <p data-ng-show="pomodoro.active && pomodoro.type == 'break'" class="text-success">Break</p>
      </div>
      <div class="row-fluid" data-ng-show="pomodoro.active">
        <h2>{{ pomodoro.delta }}</h2>
      </div>
    </div>
  </div>
</div>

<!-- Loading div -->
<div data-ng-show="!task">Loading</div>

<!-- Main content -->
<div class="container-fluid" data-ng-show="task">
  <div class="row-fluid">
    <div class="span2">
      <ul class="nav nav-list">
        <li class="nav-header">Task Hierarchy</li>
        <li data-ng-repeat="parent in hierarchy" data-ng-class="{ active: $last }"><a data-ng-click="up($index)">{{ parent.name }}</a>
      </ul>
    </div>

    <!-- Creation form -->
    <div class="span10" data-ng-show="showCreate">
      <div class="row-fluid">
        <form class="form-horizontal">
          <legend data-ng-show="!editing">New Subtask</legend>
          <legend data-ng-show="editing">Editing "{{ editTask.name }}"</legend>
          <div class="control-group">
            <label class="control-label">Name</label>
            <div class="controls">
              <input type="text" placeholder="Name" data-ng-model="editTask.name" />
            </div>
          </div>

          <div class="control-group">
            <label class="control-label">Estimate</label>
            <div class="controls">
              <input type="text" placeholder="Estimated total Pomodoros" data-ng-model="editTask.estimated" />
            </div>
          </div>

          <div class="control-group" data-ng-show="editing">
            <label class="control-label">Elapsed</label>
            <div class="controls">
              <input type="text" placeholder="Pomodoros so far" data-ng-model="editTask.elapsed" />
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" data-ng-click="commit()">{{ commitLabel }}</button>
            <button class="btn" data-ng-click="showCreate = false">Cancel</button>
          </div>
        </form>
      </div>
    </div>


    <!-- Content -->
    <div class="span10" data-ng-show="!showCreate">
      <!-- Meta row -->
      <div class="row-fluid">
        <!-- Combined totals, if there are children -->
        <div class="span2" data-ng-show="task.children && task.children.length">
          <strong><span class="muted">Total:</span> {{ showTotals(task) }}</strong>
        </div>

        <div class="span2">
          <strong><span class="muted" data-ng-show="task.children && task.children.length">This:</span> {{ showMine(task) }}</strong>
        </div>

        <div class="offset1 span5">
          <button class="btn btn-danger" data-ng-enabled="!pomodoro.active" data-ng-click="doPomodoro()">Pomodoro</button>
          <button class="btn btn-success" data-ng-click="newChild()">+Subtask</button>
          <button class="btn" data-ng-click="edit()">Edit</button>
          <button class="btn btn-inverse" data-ng-click="delete()">Delete</button>
        </div>
      </div>

      <div class="row-fluid" data-ng-show="task.children && task.children.length">
        <h3>Subtasks</h3>
        <div class="row-fluid" data-ng-repeat="child in task.children | subtaskSort">
          <div class="span4"><a data-ng-click="showChild(child.id)"><strong>{{child.name}}</strong></a></div>
          <div class="span1">
            <p data-ng-show="child.children && child.children.length">{{ showTotals(child) }}</p>
          </div>
          <div class="span1">
            <p>{{ showMine(child) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
